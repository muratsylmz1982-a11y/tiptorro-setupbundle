<Window x:Class="SetupManager.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="SetupManager - Tiptorro System Setup Tool" 
        Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Value Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        
        <!-- Status Indicator Styles -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>

        <Style x:Key="StatusIndicatorGreen" TargetType="Ellipse" BasedOn="{StaticResource StatusIndicatorStyle}">
            <Setter Property="Fill" Value="#4CAF50"/>
        </Style>

        <Style x:Key="StatusIndicatorRed" TargetType="Ellipse" BasedOn="{StaticResource StatusIndicatorStyle}">
            <Setter Property="Fill" Value="#F44336"/>
        </Style>

        <Style x:Key="StatusIndicatorOrange" TargetType="Ellipse" BasedOn="{StaticResource StatusIndicatorStyle}">
            <Setter Property="Fill" Value="#FF9800"/>
        </Style>

        <!-- Card Style -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="4" ShadowDepth="2" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Header Style -->
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Foreground" Value="#333333"/>
        </Style>

        <!-- Button Style -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="SuccessButton" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="WarningButton" TargetType="Button">
            <Setter Property="Background" Value="#FF9800"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3" Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="🔧" FontSize="24" Margin="0,0,12,0"/>
                    <StackPanel>
                        <TextBlock Text="SetupManager" FontSize="22" FontWeight="Bold" Foreground="White"/>
                        <TextBlock Text="{Binding CurrentProfile}" FontSize="14" Foreground="#E3F2FD"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="🔄 Aktualisieren" 
                            Command="{Binding RefreshAllCommand}"
                            Style="{StaticResource PrimaryButton}"/>
                    <Button Content="🚀 Optimieren" 
                            Command="{Binding OptimizeSystemCommand}"
                            Style="{StaticResource SuccessButton}"/>
                    <Button Content="ℹ️ Info" 
                            Command="{Binding ShowAboutCommand}"
                            Style="{StaticResource PrimaryButton}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Status Overview -->
                <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="System Status" Style="{StaticResource HeaderStyle}"/>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Style="{StaticResource StatusIndicatorGreen}" 
                                         Visibility="{Binding IsKioskOptimized, Converter={StaticResource BoolToVisConverter}}"/>
                                <TextBlock Text="{Binding SystemStatus}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Geräte" Style="{StaticResource HeaderStyle}"/>
                            <TextBlock Text="{Binding ConnectedDevices, StringFormat='{}{0} verbunden'}" 
                                       FontSize="24" FontWeight="Bold"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Drucker" Style="{StaticResource HeaderStyle}"/>
                            <TextBlock Text="{Binding InstalledPrinters, StringFormat='{}{0} installiert'}" 
                                       FontSize="24" FontWeight="Bold"/>
                        </StackPanel>

                        <StackPanel Grid.Column="3">
                            <TextBlock Text="Energieplan" Style="{StaticResource HeaderStyle}"/>
                            <TextBlock Text="{Binding PowerPlan}" FontSize="16" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Service Tabs -->
                <TabControl Grid.Row="1" Margin="0,16,0,0">
                    
                    <!-- Device Manager Tab -->
                    <TabItem Header="🔌 Geräte-Manager">
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Device Manager Controls -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                                <Button Content="🔍 Geräte scannen" 
                                        Command="{Binding DeviceManagerVM.RefreshCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <Button Content="📡 CCTalk scannen" 
                                        Command="{Binding DeviceManagerVM.ScanCCTalkCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <Button Content="🩺 Service-Health" 
                                        Command="{Binding DeviceManagerVM.CheckServiceHealthCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <TextBlock Text="{Binding DeviceManagerVM.ServiceStatus}" 
                                           VerticalAlignment="Center" 
                                           Margin="16,0,0,0" 
                                           FontWeight="SemiBold"/>
                            </StackPanel>

                            <!-- Device Lists -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- All Devices -->
                                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Alle Geräte" Style="{StaticResource HeaderStyle}"/>
                                        <DataGrid ItemsSource="{Binding DeviceManagerVM.Devices}"
                                                  SelectedItem="{Binding DeviceManagerVM.SelectedDevice}"
                                                  AutoGenerateColumns="False"
                                                  Height="300">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                                <DataGridTextColumn Header="Typ" Binding="{Binding Type}" Width="100"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding IsHealthy}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </Border>

                                <!-- CCTalk Devices -->
                                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock Text="CCTalk Geräte" Style="{StaticResource HeaderStyle}"/>
                                        <DataGrid ItemsSource="{Binding DeviceManagerVM.CctalkDevices}"
                                                  AutoGenerateColumns="False"
                                                  Height="300">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                                <DataGridTextColumn Header="Typ" Binding="{Binding Type}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Device Details -->
                            <Button Grid.Row="2" Content="📋 Details anzeigen" 
                                    Command="{Binding DeviceManagerVM.ShowDeviceDetailsCommand}"
                                    Style="{StaticResource PrimaryButton}"
                                    HorizontalAlignment="Left"/>
                        </Grid>
                    </TabItem>

                    <!-- Printer Service Tab -->
                    <TabItem Header="🖨️ Drucker-Service">
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Printer Controls -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                                <Button Content="🔄 Aktualisieren" 
                                        Command="{Binding PrinterServiceVM.RefreshCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <Button Content="⚡ Alle installieren" 
                                        Command="{Binding PrinterServiceVM.InstallSupportedPrintersCommand}"
                                        Style="{StaticResource SuccessButton}"/>
                                <Button Content="🔧 Spooler neustarten" 
                                        Command="{Binding PrinterServiceVM.RestartSpoolerCommand}"
                                        Style="{StaticResource WarningButton}"/>
                                <TextBlock Text="{Binding PrinterServiceVM.SpoolerStatus}" 
                                           VerticalAlignment="Center" 
                                           Margin="16,0,0,0" 
                                           FontWeight="SemiBold"/>
                            </StackPanel>

                            <!-- Printer Lists -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Detected Printers -->
                                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Erkannte Drucker" Style="{StaticResource HeaderStyle}"/>
                                        <DataGrid ItemsSource="{Binding PrinterServiceVM.DetectedPrinters}"
                                                  SelectedItem="{Binding PrinterServiceVM.SelectedPrinter}"
                                                  AutoGenerateColumns="False"
                                                  Height="250">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                                <DataGridTextColumn Header="Modell" Binding="{Binding Model}" Width="120"/>
                                                <DataGridTextColumn Header="Verbindung" Binding="{Binding ConnectionType}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </Border>

                                <!-- Installed Printers -->
                                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Installierte Drucker" Style="{StaticResource HeaderStyle}"/>
                                        <DataGrid ItemsSource="{Binding PrinterServiceVM.InstalledPrinters}"
                                                  AutoGenerateColumns="False"
                                                  Height="250">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Printer Actions -->
                            <StackPanel Grid.Row="2" Orientation="Horizontal">
                                <Button Content="⚙️ Ausgewählten installieren" 
                                        Command="{Binding PrinterServiceVM.InstallSelectedPrinterCommand}"
                                        Style="{StaticResource SuccessButton}"/>
                                <Button Content="🧪 Testdruck" 
                                        Command="{Binding PrinterServiceVM.TestPrintCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <Button Content="📋 Details" 
                                        Command="{Binding PrinterServiceVM.ShowPrinterDetailsCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <TextBlock Text="{Binding PrinterServiceVM.InstallationProgress}" 
                                           VerticalAlignment="Center" 
                                           Margin="16,0,0,0"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </Grid>
                    </TabItem>

                    <!-- Power Service Tab -->
                    <TabItem Header="⚡ Energie-Management">
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Power Controls -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                                <Button Content="🔄 Status aktualisieren" 
                                        Command="{Binding PowerServiceVM.RefreshCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                                <Button Content="🚀 Kiosk-Optimierung" 
                                        Command="{Binding PowerServiceVM.ApplyKioskOptimizationCommand}"
                                        Style="{StaticResource WarningButton}"/>
                                <Button Content="⚡ High Performance" 
                                        Command="{Binding PowerServiceVM.SetHighPerformancePlanCommand}"
                                        Style="{StaticResource SuccessButton}"/>
                                <Button Content="🔄 Standard wiederherstellen" 
                                        Command="{Binding PowerServiceVM.RestoreDefaultsCommand}"
                                        Style="{StaticResource PrimaryButton}"/>
                            </StackPanel>

                            <!-- Power Status -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Current Settings -->
                                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Aktuelle Einstellungen" Style="{StaticResource HeaderStyle}"/>
                                        
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Energieplan:" Margin="0,4"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding PowerServiceVM.CurrentPowerPlan}" FontWeight="SemiBold" Margin="8,4"/>

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Kiosk-optimiert:" Margin="0,4"/>
                                            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="8,4">
                                                <Ellipse Style="{StaticResource StatusIndicatorGreen}" 
                                                         Visibility="{Binding PowerServiceVM.IsKioskOptimized, Converter={StaticResource BoolToVisConverter}}"/>
                                                <TextBlock Text="{Binding PowerServiceVM.IsKioskOptimized}" VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Monitor Timeout:" Margin="0,4"/>
                                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding PowerServiceVM.MonitorTimeout}" Margin="8,4"/>

                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Festplatten Timeout:" Margin="0,4"/>
                                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding PowerServiceVM.DiskTimeout}" Margin="8,4"/>

                                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Standby Timeout:" Margin="0,4"/>
                                            <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding PowerServiceVM.StandbyTimeout}" Margin="8,4"/>

                                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Hibernation:" Margin="0,4"/>
                                            <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding PowerServiceVM.HibernationEnabled}" Margin="8,4"/>

                                            <TextBlock Grid.Row="6" Grid.Column="0" Text="Screensaver:" Margin="0,4"/>
                                            <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding PowerServiceVM.ScreensaverEnabled}" Margin="8,4"/>

                                            <TextBlock Grid.Row="7" Grid.Column="0" Text="USB Selective Suspend:" Margin="0,4"/>
                                            <TextBlock Grid.Row="7" Grid.Column="1" Text="{Binding PowerServiceVM.UsbSelectiveSuspendEnabled}" Margin="8,4"/>
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- Individual Actions -->
                                <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Einzelne Aktionen" Style="{StaticResource HeaderStyle}"/>
                                        
                                        <Button Content="❄️ Hibernation deaktivieren" 
                                                Command="{Binding PowerServiceVM.DisableHibernationCommand}"
                                                Style="{StaticResource WarningButton}"
                                                Margin="0,8" 
                                                HorizontalAlignment="Stretch"/>
                                        
                                        <Button Content="🖥️ Screensaver deaktivieren" 
                                                Command="{Binding PowerServiceVM.DisableScreensaverCommand}"
                                                Style="{StaticResource WarningButton}"
                                                Margin="0,8" 
                                                HorizontalAlignment="Stretch"/>
                                        
                                        <Button Content="📋 Details anzeigen" 
                                                Command="{Binding PowerServiceVM.ShowPowerDetailsCommand}"
                                                Style="{StaticResource PrimaryButton}"
                                                Margin="0,8" 
                                                HorizontalAlignment="Stretch"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Power Status Message -->
                            <TextBlock Grid.Row="2" 
                                       Text="{Binding PowerServiceVM.OptimizationStatus}" 
                                       Margin="0,16,0,0"
                                       FontWeight="SemiBold"/>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </ScrollViewer>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="#F5F5F5" Padding="16,8" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Messages -->
                <ScrollViewer Grid.Column="0" 
                              VerticalScrollBarVisibility="Hidden" 
                              HorizontalScrollBarVisibility="Auto"
                              MaxHeight="100">
                    <ItemsControl ItemsSource="{Binding StatusMessages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" FontFamily="Consolas" FontSize="11" Margin="0,1"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Progress Indicator -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <ProgressBar IsIndeterminate="{Binding IsRefreshing}" 
                                 Width="100" Height="16" 
                                 Margin="8,0"/>
                    <TextBlock Text="SetupManager v1.0" 
                               Foreground="#666666" 
                               FontSize="11"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>